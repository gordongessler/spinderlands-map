<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <title>Spinelands Interactive Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="scripts/leaflet.css">
    <script src="scripts/leaflet.js"></script>
    <link rel="stylesheet" href="scripts/L.Control.Window.css" />
    <script src="scripts/L.Control.Window.js"></script>
    <link rel="stylesheet" href="scripts/leaflet.extra-markers.min.css">
    <script src="scripts/leaflet.extra-markers.min.js"></script>
    <script src="scripts/jquery-3.6.0.js"></script>
    <script src="https://kit.fontawesome.com/8275689564.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body style="height: 100%;margin: 0;">
    <div id="map" style="width: 100%; height: 100%; background: #fcfcfc;"></div>

    <script type="text/javascript">
        //Create layers
        var clean = L.tileLayer('maps/clean/{z}/{x}/{y}.png', {
            noWrap: true
        });

        var grayscale = L.tileLayer('maps/grayscale/{z}/{x}/{y}.png', {
            noWrap: true
        });

        var territories = L.tileLayer('maps/territories/{z}/{x}/{y}.png', {
            noWrap: true
        });

        var labels = L.tileLayer('maps/labels/{z}/{x}/{y}.png', {
            noWrap: true
        });

        var hex = L.tileLayer('maps/hex/{z}/{x}/{y}.png', {
            noWrap: true
        });

        var wind_rose = L.tileLayer('maps/wind_rose/{z}/{x}/{y}.png', {
            noWrap: true
        });

        //Create Map
        var map = L.map('map', {
            minZoom: 1,
            maxZoom: 5,
            attributionControl: false,
            layers: [clean, grayscale],
            //I'm not sure why I'm using simple CRS but the tutorials said to do it and I want to work on content so I will revisit this later
            crs: L.CRS.Simple
        }).setView([0, 0], 2);

        //Set bounds for the map
        var mapSW = [944, 8192],
            mapNE = [7248, 0];

        map.setMaxBounds(new L.LatLngBounds(
            map.unproject(mapSW, map.getMaxZoom()),
            map.unproject(mapNE, map.getMaxZoom())
        ));

        //Add coordinate finding marker 
        var locationFinder = L.marker([-130.25, 124.5], {
            draggable: true
        }).addTo(map);
        locationFinder.bindPopup("Drag me to find coordinates").openPopup();
        locationFinder.on('dragend', function (e) {
            locationFinder.getPopup().setContent('LatLng: ' + locationFinder.getLatLng().toString() + '<br />'
                + 'Pixels: ' + map.project(locationFinder.getLatLng(), map.getMaxZoom()).toString()).openOn(map);
        });

        //Create icons
        var zirIcon = L.icon({
            iconUrl: 'images/Zir.png',

            iconSize: [81, 85],
            iconAnchor: [20, 85],
            popupAnchor: [20, -85],
            tooltipAnchor: [20, -40]
        });

        var zirCityMarker = L.ExtraMarkers.icon({
            icon: 'fa-fort-awesome',
            markerColor: 'orange',
            shape: 'penta',
            prefix: 'fa'
        });

        var zirTownMarker = L.ExtraMarkers.icon({
            icon: 'fa-home',
            markerColor: 'orange',
            shape: 'circle',
            prefix: 'fa'
        });

        //Add markers and assing popups and tooltips
        //Create marker groups
        var cities = L.layerGroup();
        var towns = L.layerGroup();
        var regions = L.layerGroup();

        //Zir        
        var zir_zir = L.marker(map.unproject([2768, 1808], map.getMaxZoom()), { icon: zirIcon }).addTo(regions);
        zir_zir.bindTooltip("Zir");
        zir_zir.on('click', function () {
            var win = L.control.window(map, {
                title: 'Zir',
                content: '<img src="images/Zir.png"><br />The Ziranthian dragonborn arrived in the desert as slaves, revolted against their opressors, and have established a advanced and erudite society. This tale of triumph is carried proudly in the in the heart of every dragonborn. Zir is protected by the Glass Dragons, knights clad in dragonglass armour, who vow to uphold the freedom and independence of the Zirantian people.They serve as guards to the city and towns, and patrol the distant borders of the desert.They guard the borders of the the Scale Valley especially well, watching closely for any hint that their Yuan- ti oppressors would return to enact their revenge.The Glass Dragons are trained in a secret monastery at the shores of Lake Memnor, high in the upper reaches of the Northern Spine.Here they commune in their dreams with their great liberator Brethezriass, the dragon who once delivered their people from slavery.Many young dragonborn travel to the town of Teghad in the hopes that they would be chosen to become Glass Dragons, and taken to the Lake Memnor.'
            }).show()
        });

        var zir_ziris = L.marker(map.unproject([2833, 1512], map.getMaxZoom()), { icon: zirCityMarker }).addTo(cities);
        zir_ziris.bindPopup("<b>Ziris</b><br /> The capital city of Zir. Ruled by the council of seven. Home to the Clarion Archives<button id='ziris'>Read more...</a>");
        zir_ziris.bindTooltip("Ziris");

        var zir_kharzim = L.marker(map.unproject([2381, 1230], map.getMaxZoom()), { icon: zirTownMarker }).addTo(towns);
        zir_kharzim.bindPopup("Kharzim");
        zir_kharzim.bindTooltip("Kharzim");

        var zir_rezma = L.marker(map.unproject([2328, 1961], map.getMaxZoom()), { icon: zirTownMarker }).addTo(towns);
        zir_rezma.bindPopup("Rezma");
        zir_rezma.bindTooltip("Rezma");

        var zir_kelrix = L.marker(map.unproject([3427, 1862], map.getMaxZoom()), { icon: zirTownMarker }).addTo(towns);
        zir_kelrix.bindPopup("Kelrix");
        zir_kelrix.bindTooltip("Kelrix");

        var zir_garut = L.marker(map.unproject([3124, 1140], map.getMaxZoom()), { icon: zirTownMarker }).addTo(towns);
        zir_garut.bindPopup("Garut");
        zir_garut.bindTooltip("Garut");

        var zir_teghad = L.marker(map.unproject([4172, 1681], map.getMaxZoom()), { icon: zirTownMarker }).addTo(towns);
        zir_teghad.bindPopup("Teghad");
        zir_teghad.bindTooltip("Teghad");

        //Create windows with content for some markers
        //This feels hacky and I don't like it. It works so far but I will probably replace it if I figure out how.
        map.on('popupopen', function () {
            $('#ziris').click(function () {

                var win = L.control.window(map, {
                    maxWidth: 400,
                    title: 'The great glass city of Ziris',
                    content: 'The great glass city of Ziris, Jewel of the Desert, is the seat of the Council of Seven, the ruling organisation of Zir. The Council is made up of the seven wisest and most powerful wizards in Zir, and they rule the desert nation on principles of rationality and knowledge. Ziris is home to the Clarion Archives, rumoured to be the greatest library in the civilised world. The Council holds that this library is to be the definitive repository of all that is known. Legions of scribes and scholars work tirelessly to asymptotically converge upon this noble objective. Recently the Council has ruled allow outsiders to contribute to the Archives by constructing Obsidian Lyceums in other nations, places of research and instruction in Ziranthian arcanism.'
                }).show()

            });
        });

        //Create layer groups
        var baseLayers = {
            "Grayscale": grayscale,
            "Clean": clean
        },
            overlays = {
                "Regions": regions,
                "Cities": cities,
                "Towns": towns,
                "Territories": territories,
                "Labels": labels,
                "Hex overlay": hex,
                "Wind Rose": wind_rose,
            };

        //Display marker groups
        regions.addTo(map);
        cities.addTo(map);
        towns.addTo(map);

        //Add Layers Control
        L.control.layers(baseLayers, overlays).addTo(map);

    </script>
</body>

</html>