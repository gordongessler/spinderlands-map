<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <title>Spinderlands Interactive Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="scripts/leaflet.css">
    <link rel="stylesheet" href="scripts/L.Control.Window.css" />
    <script src="scripts/leaflet.js"></script>
    <script src="scripts/L.Control.Window.js"></script>
    <script src="scripts/jquery-3.6.0.js"></script>
</head>

<body style="height: 100%;margin: 0;">
    <div id="map" style="width: 100%; height: 100%; background: #888888;"></div>

    <script type="text/javascript">
        //Create layers
        var geograpihcal = L.tileLayer('maps/geographical/{z}/{x}/{y}.png', {
            noWrap: true
        });
        var political = L.tileLayer('maps/political/{z}/{x}/{y}.png', {
            noWrap: true
        });

        //Create Map
        var map = L.map('map', {
            minZoom: 0,
            maxZoom: 5,
            attributionControl: false,
            layers: [geograpihcal, political],
            crs: L.CRS.Simple
        }).setView([0, 0], 2);

        //Set bounds for the map
        var mapSW = [0, 8192],
            mapNE = [8192, 0];

        map.setMaxBounds(new L.LatLngBounds(
            map.unproject(mapSW, map.getMaxZoom()),
            map.unproject(mapNE, map.getMaxZoom())
        ));

        //Add coordinate finding marker 
        var locationFinder = L.marker([-130.25, 124.5], {
            draggable: true
        }).addTo(map);
        locationFinder.bindPopup("Drag me to find coordinates").openPopup();
        locationFinder.on('dragend', function (e) {
            locationFinder.getPopup().setContent('LatLng: ' + locationFinder.getLatLng().toString() + '<br />'
                + 'Pixels: ' + map.project(locationFinder.getLatLng(), map.getMaxZoom()).toString()).openOn(map);
        });

        //Create icons
        var zirIcon = L.icon({
            iconUrl: 'images/Zir.png',

            iconSize: [81, 85],
            iconAnchor: [20, 85],
            popupAnchor: [20, -85],
            tooltipAnchor: [20, -40]
        });

        //Add markers and assing popups and tooltips
        //Create marker groups
        var cities = L.layerGroup();
        var regions = L.layerGroup();

        //Zir        
        var zir_zir = L.marker(map.unproject([2768, 1808], map.getMaxZoom()), { icon: zirIcon }).addTo(regions);
        zir_zir.bindPopup("Zir");
        zir_zir.bindTooltip("Zir");

        var zir_ziris = L.marker(map.unproject([2833, 1512], map.getMaxZoom())).addTo(cities);
        zir_ziris.bindPopup("<b>Ziris</b><br /> The capital city of Zir. Ruled by the council of seven. Home to the Clarion Archives<br /><a id='ziris' href='#''>Test</a>");
        zir_ziris.bindTooltip("Ziris");

        var zir_kharzim = L.marker(map.unproject([2381, 1230], map.getMaxZoom())).addTo(cities);
        zir_kharzim.bindPopup("Kharzim");
        zir_kharzim.bindTooltip("Kharzim");

        var zir_rezma = L.marker(map.unproject([2328, 1961], map.getMaxZoom())).addTo(cities);
        zir_rezma.bindPopup("Rezma");
        zir_rezma.bindTooltip("Rezma");

        var zir_kelrix = L.marker(map.unproject([3427, 1862], map.getMaxZoom())).addTo(cities);
        zir_kelrix.bindPopup("Kelrix");
        zir_kelrix.bindTooltip("Kelrix");

        var zir_garut = L.marker(map.unproject([3124, 1140], map.getMaxZoom())).addTo(cities);
        zir_garut.bindPopup("Garut");
        zir_garut.bindTooltip("Garut");

        var zir_teghad = L.marker(map.unproject([4172, 1681], map.getMaxZoom())).addTo(cities);
        zir_teghad.bindPopup("Teghad");
        zir_teghad.bindTooltip("Teghad");

        //Create windows
        map.on('popupopen', function () {
            $('#ziris').click(function () {
                
                var win =  L.control.window(map,{
                    title:'The great glass city of Ziris',
                    content:'The great glass city of Ziris, Jewel of the Desert, is the seat of the Council of Seven, the ruling organisation of Zir. The Council is made up of the seven wisest and most powerful wizards in Zir, and they rule the desert nation on principles of rationality and knowledge. Ziris is home to the Clarion Archives, rumoured to be the greatest library in the civilised world. The Council holds that this library is to be the definitive repository of all that is known. Legions of scribes and scholars work tirelessly to asymptotically converge upon this noble objective. Recently the Council has ruled allow outsiders to contribute to the Archives by constructing Obsidian Lyceums in other nations, places of research and instruction in Ziranthian arcanism.'
                }).show()
                
            });
        });

        //Create layer groups
        var baseLayers = {
            "Geograpihcal": geograpihcal,
            "Political": political
        },
            overlays = {
                "Regions": regions,
                "Cities": cities
            };

        //Display marker groups
        regions.addTo(map);
        cities.addTo(map);

        //Add Layers Control
        L.control.layers(baseLayers, overlays).addTo(map);

    </script>
</body>

</html>